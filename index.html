<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Red de Farmacias ‚Äì L√≠nea Dolor | Alef Medical</title>

  <!-- SheetJS (leer Excel en el browser) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root{
      --max: 1100px;
      --pad: 16px;
      --bg: #ffffff;
      --text: #1c1c1c;
      --muted: #5b5b5b;
      --line: #e8e8e8;
      --line2:#f0f0f0;
      --green:#2bb673; /* l√≠nea verde */
      --blue:#1f2a44;
      --shadow: 0 10px 25px rgba(0,0,0,.06);
      --radius: 14px;
    }

    *{ box-sizing: border-box; }
    body{
      margin:0;
      font-family: Arial, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    img{ max-width:100%; display:block; }

    .container{
      max-width: var(--max);
      margin: 0 auto;
      padding: 0 var(--pad);
    }

    /* ---------- Header ---------- */
    header{
      padding: 26px 0 0;
      border-bottom: 1px solid var(--line);
    }

    .brand-top{
      display:flex;
      flex-direction: row;
      align-items:center;
      gap: 14px;
      padding-bottom: 14px;
      justify-content: center; /* centrar logo + texto */
      text-align: center;
    }
    .brand-top img{
      height: 96px; /* logo grande */
      width: auto;
      object-fit: contain;
    }
    .brand-top .brand-name{
      margin: 0;
      font-size: 26px; /* t√≠tulo Alef un poco m√°s grande */
      font-weight: 700;
      color: var(--blue);
      line-height: 1.05;
      letter-spacing: .2px;
    }
    .brand-top .brand-text{
      font-size: 32px; /* mayor tama√±o para la marca */
      font-weight: 800;
      color: var(--blue);
      letter-spacing: .2px;
      line-height: 1;
      margin: 0;
    }

    .green-sep{
      height: 4px;
      background: var(--green);
      width: 100%;
    }

    .brand-row{
      padding: 18px 0 14px;
    }
    .brand-row-grid{
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      align-items:center;
      gap: 14px;
    }
    .brand-row-grid .left{ justify-self:start; }
    .brand-row-grid .right{ justify-self:end; }
    .brand-row-grid img{
      height: 56px;
      width:auto;
      object-fit:contain;
    }
    .brand-row-grid h1{
      margin:0;
      font-size: 28px;
      color: var(--blue);
      text-align:center;
      line-height: 1.1;
      letter-spacing: .2px;
    }

    .soft-sep{
      height: 1px;
      background: var(--line);
      width: 100%;
    }

    /* ---------- Filters Card ---------- */
    .filters-wrap{
      padding: 18px 0 10px;
    }
    .card{
      background:#fff;
      border: 1px solid var(--line2);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
    }
    .filters-grid{
      display:grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 12px;
      align-items:end;
    }
    label{
      display:block;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 6px;
    }
    select, input, textarea{
      width:100%;
      padding: 11px 12px;
      border: 1px solid var(--line);
      border-radius: 12px;
      font-size: 15px;
      outline: none;
      background:#fff;
      height: 44px; /* igual altura para selects e inputs */
      line-height: 1.1;
    }
    select{ appearance: none; -webkit-appearance: none; }
    select:focus, input:focus, textarea:focus{
      border-color: rgba(43,182,115,.65);
      box-shadow: 0 0 0 3px rgba(43,182,115,.15);
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
      padding: 11px 14px;
      border-radius: 12px;
      border: 1px solid rgba(31,42,68,.18);
      background: #fff;
      color: var(--blue);
      cursor:pointer;
      font-weight: 700;
      font-size: 14px;
      white-space:nowrap;
      height: 44px;
    }
    .btn:hover{ box-shadow: 0 10px 25px rgba(0,0,0,.06); }

    .hint{
      margin-top: 10px;
      font-size: 13px;
      color: var(--muted);
    }

    /* ---------- List ---------- */
    .list-header{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap: 12px;
      margin: 14px 0 10px;
    }
    .status{
      font-size: 14px;
      color: var(--muted);
    }

    .list{
      border-radius: var(--radius);
      overflow:visible;
      background:transparent;
      padding: 6px 0;
    }
    .row{
      background:#fff;
      border: 1px solid var(--line2);
      border-radius: var(--radius);
      padding: 18px 20px;
      margin: 12px 0;
      box-shadow: 0 6px 18px rgba(31,42,68,.06);
      display: block;
      transition: transform .12s ease, box-shadow .12s ease;
      position: relative;
      overflow: hidden;
    }
    .row:hover{ transform: translateY(-4px); box-shadow: 0 12px 30px rgba(31,42,68,.09); }
    .row h3{
      margin: 0 0 8px;
      font-size: 18px; /* un toque m√°s grande */
      letter-spacing: .2px;
    }
    .meta{
      color: var(--muted);
      font-size: 14px;
      line-height: 1.5; /* m√°s aire entre l√≠neas */
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px; /* separar m√°s las 3 l√≠neas */
    }
    /* Links: sin subrayado por defecto */
    a{ text-decoration: none; color: inherit; }
    .meta a{ color: var(--blue); text-decoration: none; }
    .meta a:hover{ opacity: .85; }
    /* L√≠neas dentro de cada card (3 l√≠neas): direcci√≥n / localidad¬∑provincia / contactos */
    .meta .line{ display:block; }
    .row::before{
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 6px;
      background: linear-gradient(180deg,var(--green), rgba(43,182,115,.6));
    }
    .row > *{ margin-left: 12px; } /* evitar choque con el acento */

    .pill{
      display:inline-flex;
      align-items:center;
      padding: 3px 10px;
      border-radius: 999px;
      background: rgba(31,42,68,.06);
      color: var(--blue);
      font-size: 12px;
      font-weight: 700;
    }
    .empty{
      padding: 18px 16px;
      color: var(--muted);
      font-size: 14px;
    }

    /* ---------- TOTAX ---------- */
    .section-sep{
      height: 1px;
      background: var(--line);
      width: 100%;
      margin: 24px 0;
    }
    /* Wrapper que contiene el banner y el formulario */
    .totax-contact{
      display:flex;
      gap: 20px;
      align-items:stretch; /* para que banner y form queden de la misma altura */
      justify-content:center;
      margin-top: 18px;
      margin-bottom: 18px;
      flex-wrap:wrap;
    }

    .totax{
      display:flex;
      align-items:center;
      justify-content:center;
      flex: 1 1 420px;
      min-width: 260px;
    }
    .totax img{
      max-width: 420px;   /* un poco m√°s chico */
      max-height: 360px; /* limitar altura para que coincida mejor con el card */
      width: auto;
      height: auto;
      display: block;
      border-radius: 14px;
      box-shadow: var(--shadow);
    }
    .contact-card{
      flex: 1 1 420px;
      min-width: 280px;
      display:flex;
      align-items:stretch;
      justify-content:center;
    }
    .contact-card .card{ width:100%; height:100%; display:flex; flex-direction:column; }
    .contact-card form{ display:flex; flex-direction:column; flex:1; }
    .form-actions{ margin-top: auto; }
    .totax .text{
      max-width: 520px;
      margin: 0;
      color: var(--blue);
      font-size: 16px;
      line-height: 1.45;
      font-weight: 600;
      background: rgba(43,182,115,0.06); /* fondo tenue verde */
      padding: 12px 14px;
      border-radius: 10px;
      border-left: 4px solid rgba(43,182,115,0.9);
      box-shadow: 0 6px 18px rgba(31,42,68,.04);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .totax .text em{ font-style: normal; color: var(--muted); font-weight: 500; }
    .totax .text strong{ color: var(--green); font-weight: 800; }
    .totax .text:hover{ transform: translateY(-3px); box-shadow: 0 12px 30px rgba(31,42,68,.06); }

    /* Asegurar que banner y formulario tengan altura similar y moderada */
      /* Ajuste para que banner y form sean m√°s compactos y parejos */
      .totax-contact .totax,
      .totax-contact .contact-card { min-height: 260px; }
      .totax img{ max-height: 260px; max-width: 520px; height: auto; }
      .contact-card .card { min-height: 260px; }

    /* Form compacto: Nombre + Celular en la misma fila y t√≠tulo dentro del form */
    footer .card{ padding: 10px; }
    footer .contact-grid{ grid-template-columns: 1fr 1fr; gap: 8px; align-items: center; }
    footer .contact-grid .full{ grid-column: 1 / -1; }
    .contact-title{ margin: 0 0 12px; font-size: 18px; color: var(--blue); }

    /* Chips para contactos y link de mapa */
    .contact-chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(31,42,68,.06);
      color: var(--blue);
      font-weight:700;
      text-decoration:none;
      border: 1px solid rgba(31,42,68,.06);
      margin-right:8px;
      font-size:13px;
    }
    .contact-chip:hover{ box-shadow: 0 8px 18px rgba(31,42,68,.06); }
    .map-link{ text-decoration:none; color:inherit; }
    .map-link{ display:inline-flex; align-items:center; gap:6px; text-decoration:none; color:inherit; }
    .map-link .map-text{ text-decoration:none; color:inherit; }
    .map-link .map-emoji{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:26px;
      height:26px;
      border-radius:999px;
      background: rgba(31,42,68,.06); /* mismo que .contact-chip */
      color: var(--blue);
      font-size:14px;
      border: 1px solid rgba(31,42,68,.06);
      line-height:1;
    }
    .map-link:hover{ text-decoration:none; opacity:.95; }

    /* ---------- Footer / Contact ---------- */
    footer{
      padding: 8px 0 34px;
      background: rgba(111, 123, 117, 0.169); /* fondo verde tenue */
      border-top: 1px solid rgba(43,182,115,0.06);
    }
    .contact-grid{
      display:grid;
      grid-template-columns: 1fr; /* apilar cada campo del formulario de contacto */
      gap: 8px; /* m√°s compacto */
    }
    .contact-grid .full{ grid-column: 1 / -1; }
    textarea{ min-height: 110px; resize: vertical; }

    /* Compactar exclusivamente el formulario del footer */
    footer .card{ padding: 12px; }
    footer label{ font-size: 12px; }
    footer input, footer textarea{ padding: 6px 8px; font-size: 14px; height: 36px; }
    footer textarea{ min-height: 64px; }
    .form-actions{ gap: 8px; margin-top: 8px; }
    .btn-primary{ padding: 8px 10px; height: 36px; font-size: 13px; }
    footer .hint{ margin-top:8px; font-size:13px; }

    .form-actions{
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content:flex-start;
      margin-top: 10px;
    }
    .btn-primary{
      background: var(--blue);
      color:#fff;
      border-color: rgba(31,42,68,.25);
    }
    .btn-primary:hover{ opacity:.96; }

    .msg{
      font-size: 14px;
      color: var(--muted);
    }
    .msg.ok{ color: #157347; }
    .msg.err{ color: #b00020; }

    /* ---------- Responsive ---------- */
    @media (max-width: 860px){
      .filters-grid{ grid-template-columns: 1fr; }
      .btn{ width: 100%; }
      .brand-row-grid{
        grid-template-columns: 1fr;
        justify-items:center;
      }
      .brand-row-grid .left, .brand-row-grid .right{ justify-self:center; }
      .brand-row-grid h1{ font-size: 24px; }
      .contact-grid{ grid-template-columns: 1fr; }
      .totax{ flex-direction: column; text-align:center; align-items:center; }
      .totax .text{ text-align:center; font-size:15px; padding:10px 12px; }
    }
  </style>
</head>

<body>

<header>
  <div class="container">
    <div class="brand-top">
      <img src="logo_alefmedical.png" alt="Alef Medical"
           onerror="this.style.display='none';" />
      <div>
        <div class="brand-text">Alef Medical Argentina</div>
      </div>
    </div>
  </div>

  <div class="green-sep"></div>

  <div class="container brand-row">
    <div class="brand-row-grid">
      <div class="left">
        <img src="Logo_Oramorph_color.png" alt="Oramorph" onerror="this.style.display='none';" />
      </div>

      <h1>Red de Farmacias</h1>

      <div class="right">
        <img src="Logo_Alefdona_color.png" alt="Alefdona" onerror="this.style.display='none';" />
      </div>
    </div>
  </div>

  <div class="soft-sep"></div>
</header>

<main class="container">
  <!-- Filtros -->
  <section class="filters-wrap">
    <div class="card">
      <div class="filters-grid">
        <div>
          <label for="provinciaSelect">Provincia</label>
          <select id="provinciaSelect" aria-label="Filtrar por provincia">
            <option value="" selected>Sin filtro</option>
            <!-- din√°mico -->
          </select>
        </div>

        <div>
          <label for="localidadInput">Localidad</label>
          <input id="localidadInput" list="localidadesList" placeholder="Escrib√≠ para buscar (opcional)" autocomplete="off" />
          <datalist id="localidadesList"></datalist>
        </div>

        <div>
          <button class="btn" id="todoPaisBtn" type="button" aria-label="Limpiar filtros">
              Limpiar filtros
            </button>
        </div>
      </div>

      <div class="hint">
        Al ingresar se muestran <b>todas</b> las farmacias. Us√° los filtros solo si necesit√°s acotar la b√∫squeda.
      </div>
    </div>
  </section>

  <!-- Estado + Listado -->
  <section>
    <div class="list-header">
      <div class="status" id="statusText">Cargando listado‚Ä¶</div>
      <div class="pill" id="pillInfo" style="display:none;"></div>
    </div>

    <div class="list" id="farmaciasList">
      <div class="empty">Cargando‚Ä¶</div>
    </div>
  </section>

  <!-- TOTAX + CONTACT -->
  <!-- (Se movi√≥ el banner y el formulario al footer para evitar duplicados) -->

<!-- Footer Contacto -->
</main>

<!-- Footer Contacto -->
<footer>
  <div class="container">
    <div class="totax-contact" aria-label="Banner TOTAX y Contacto">
      <div class="totax" aria-label="Banner TOTAX">
        <a href="https://Totax.com.ar" target="_blank" rel="noopener noreferrer">
          <img src="Logo_Totax_color.png" alt="TOTAX" onerror="this.style.display='none';" />
        </a>
      </div>

      <div class="contact-card">
        <div class="card">
          <h3 class="contact-title">Contacto</h3>
          <form id="contactForm" novalidate>
            <div class="contact-grid">
                    <div>
                      <label for="nombreApellido">Nombre y apellido</label>
                      <input id="nombreApellido" name="name" type="text" required  />
                    </div>

                    <div>
                      <label for="celular">Celular</label>
                      <input id="celular" name="phone" type="tel" required  />
                    </div>

                    <div class="full">
                      <label for="consulta">Consulta</label>
                      <textarea id="consulta" name="message" required placeholder="Escrib√≠ tu consulta‚Ä¶"></textarea>
                    </div>
                  </div>

            <div class="form-actions">
              <button class="btn btn-primary" id="sendBtn" type="submit">Enviar</button>
              <div class="msg" id="formMsg"></div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</footer>

<script>
  // -----------------------------
  // 1) Lectura Excel + Mapeo
  // -----------------------------
  let allRows = [];      // canonical rows
  let filteredRows = []; // currently shown

  const provinciaSelect = document.getElementById('provinciaSelect');
  const localidadInput  = document.getElementById('localidadInput');
  const localidadesList = document.getElementById('localidadesList');
  const todoPaisBtn     = document.getElementById('todoPaisBtn');

  const statusText = document.getElementById('statusText');
  const pillInfo   = document.getElementById('pillInfo');
  const farmaciasList = document.getElementById('farmaciasList');

  function norm(v){ return String(v ?? '').trim(); }
  function low(v){ return norm(v).toLowerCase(); }

  // Mapeo flexible: soporta tu Excel real (name/address/locality/city/province/whatsappDisplay/phoneDisplay)
  // y tambi√©n encabezados "Farmacia/Direcci√≥n/Localidad/Provincia/Tel√©fono/WhatsApp" si alg√∫n d√≠a los cambi√°s.
  function toCanonical(row){
    const name = norm(row.Farmacia ?? row.farmacia ?? row.name ?? row.Nombre ?? row.nombre);

    const address = norm(row['Direcci√≥n'] ?? row.Direccion ?? row.address ?? row.direccion);

    const province = norm(row.Provincia ?? row.province ?? row.provincia);

    // En tu Excel real suelen existir "locality" y "city"
    const locality = norm(row.Localidad ?? row.locality ?? row.city ?? row.localidad);

    // Separar Tel y WhatsApp (en tu Excel: phoneDisplay / whatsappDisplay)
    const phone = norm(row['Tel√©fono'] ?? row.Telefono ?? row.phoneDisplay ?? row.phone);
    const whatsapp = norm(row.WhatsApp ?? row.whatsappDisplay ?? row.whatsapp);

    return {
      name: name || '‚Äî',
      address: address || '‚Äî',
      province: province || '‚Äî',
      locality: locality || '‚Äî',
      phone: phone || '',
      whatsapp: whatsapp || ''
    };
  }

  async function loadExcel(){
    try{
      const res = await fetch('farmacias.xlsx', { cache: 'no-store' });
      if(!res.ok) throw new Error('No se pudo cargar farmacias.xlsx');
      const buf = await res.arrayBuffer();
      const wb = XLSX.read(buf, { type: 'array' });

      const sheetName = wb.SheetNames[0];
      const sheet = wb.Sheets[sheetName];

      const raw = XLSX.utils.sheet_to_json(sheet, { defval: '' });
      allRows = raw.map(toCanonical).filter(r => r.name !== '‚Äî' || r.address !== '‚Äî');

      buildProvinciaOptions();
      buildLocalidadesDatalist(''); // todas
      applyFilters(); // Home: sin filtros -> todo
    }catch(err){
      console.error(err);
      statusText.textContent = 'No se pudo cargar el listado.';
      pillInfo.style.display = 'none';
      farmaciasList.innerHTML = `
        <div class="empty">
          <b>No se pudo cargar el listado</b>.<br/>
          Verific√° que <code>farmacias.xlsx</code> est√© en la misma carpeta que este <code>index.html</code>.
        </div>`;
    }
  }

  function uniqueSorted(arr){
    const s = Array.from(new Set(arr.filter(Boolean)));
    s.sort((a,b)=>a.localeCompare(b,'es'));
    return s;
  }

  function buildProvinciaOptions(){
    const keep0 = provinciaSelect.options[0];
    provinciaSelect.innerHTML = '';
    provinciaSelect.appendChild(keep0);

    const provincias = uniqueSorted(allRows.map(r => r.province).filter(p => p && p !== '‚Äî'));
    provincias.forEach(p=>{
      const opt = document.createElement('option');
      opt.value = p;
      opt.textContent = p;
      provinciaSelect.appendChild(opt);
    });
  }

  function buildLocalidadesDatalist(provinciaValue = ''){
    localidadesList.innerHTML = '';
    const rows = provinciaValue
      ? allRows.filter(r => r.province === provinciaValue)
      : allRows;

    const localidades = uniqueSorted(rows.map(r => r.locality).filter(l => l && l !== '‚Äî'));
    localidades.forEach(l=>{
      const opt = document.createElement('option');
      opt.value = l;
      localidadesList.appendChild(opt);
    });
  }

  // -----------------------------
  // 2) Links Tel/WhatsApp + Maps
  // -----------------------------
  function digitsOnly(str){
    return String(str ?? '').replace(/\D/g, '');
  }

  function buildWhatsAppLink(value){
    const v = norm(value);
    if (!v) return '';
    if (v.includes('wa.me')) return v;

    const digits = digitsOnly(v);
    // WhatsApp requiere formato internacional sin '+'
    return digits ? `https://wa.me/${digits}` : '';
  }

  function buildTelLink(value){
    const v = norm(value);
    if (!v) return '';
    const digits = digitsOnly(v);
    if (!digits) return '';

    // Para tel: usamos +<digits> (funciona bien en m√≥viles)
    return `tel:+${digits}`;
  }

  function buildMapsLink(address, locality, province){
    const q = [address, locality, province].filter(x => norm(x) && norm(x) !== '‚Äî').join(', ');
    const query = encodeURIComponent(q || address || '');
    return `https://www.google.com/maps/search/?api=1&query=${query}`;
  }

  function escapeHtml(str){
    return String(str ?? '')
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'","&#039;");
  }

  // -----------------------------
  // 3) Filtros + Render
  // -----------------------------
  function applyFilters(){
    const prov = norm(provinciaSelect.value);
    const loc  = norm(localidadInput.value);

    let rows = allRows;

    if(prov){
      rows = rows.filter(r => r.province === prov);
    }
    if(loc){
      rows = rows.filter(r => low(r.locality) === low(loc));
    }

    filteredRows = rows;
    renderList();
    updateStatus(prov, loc);
  }

  function updateStatus(prov, loc){
    const total = allRows.length;
    const shown = filteredRows.length;
    statusText.textContent = `Mostrando ${shown} de ${total} farmacias`;

    const tags = [];
    if(prov) tags.push(`Provincia: ${prov}`);
    if(loc)  tags.push(`Localidad: ${loc}`);

    if(tags.length){
      pillInfo.style.display = 'inline-flex';
      pillInfo.textContent = tags.join(' ¬∑ ');
    }else{
      pillInfo.style.display = 'none';
    }
  }

  function renderList(){
    if(!filteredRows.length){
      farmaciasList.innerHTML = `<div class="empty">No se encontraron farmacias para los filtros seleccionados.</div>`;
      return;
    }

    const frag = document.createDocumentFragment();

    filteredRows.forEach(r=>{
      const row = document.createElement('div');
      row.className = 'row';

      const mapsHref = buildMapsLink(r.address, r.locality, r.province);

      const telHref = buildTelLink(r.phone);
      const waHref  = buildWhatsAppLink(r.whatsapp);

      // Phone/WA as chips
      const phoneHtml = (r.phone && telHref)
        ? `<a class="contact-chip" href="${telHref}">üìû ${escapeHtml(r.phone)}</a>`
        : '';

      const waHtml = (r.whatsapp && waHref)
        ? `<a class="contact-chip" href="${waHref}" target="_blank" rel="noopener noreferrer">üí¨ ${escapeHtml(r.whatsapp)}</a>`
        : '';

      // Estructura en 3 l√≠neas: direcci√≥n (con emoji mapa) / localidad ¬∑ provincia / contactos (chips)
      row.innerHTML = `
        <h3>${escapeHtml(r.name)}</h3>
        <div class="meta">
          <span class="line"><b>Direcci√≥n:</b> <a class="map-link" href="${mapsHref}" target="_blank" rel="noopener noreferrer"><span class="map-text">${escapeHtml(r.address)}</span><span class="map-emoji" aria-hidden="true">üìç</span></a></span>
          <span class="line">${escapeHtml(r.locality)} ¬∑ ${escapeHtml(r.province)}</span>
          <span class="line">${phoneHtml} ${waHtml}</span>
        </div>
      `;
      frag.appendChild(row);
    });

    farmaciasList.innerHTML = '';
    farmaciasList.appendChild(frag);
  }

  // Eventos filtros
  provinciaSelect.addEventListener('change', ()=>{
    // cascada: al cambiar provincia, actualizo datalist de localidades y limpio localidad
    buildLocalidadesDatalist(provinciaSelect.value);
    localidadInput.value = '';
    applyFilters();
  });

  // filtro al confirmar (change) o Enter
  localidadInput.addEventListener('change', applyFilters);
  localidadInput.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){
      e.preventDefault();
      applyFilters();
    }
  });

  todoPaisBtn.addEventListener('click', ()=>{
    provinciaSelect.value = '';
    localidadInput.value = '';
    buildLocalidadesDatalist('');
    applyFilters();
  });

  // -----------------------------
  // 4) Formulario /api/contact
  // -----------------------------
  const contactForm = document.getElementById('contactForm');
  const formMsg = document.getElementById('formMsg');
  const sendBtn = document.getElementById('sendBtn');

  function setMsg(text, type){
    formMsg.textContent = text;
    formMsg.className = 'msg' + (type ? ' ' + type : '');
  }

  contactForm.addEventListener('submit', async (e)=>{
    e.preventDefault();
    setMsg('', '');

    const name = norm(document.getElementById('nombreApellido').value);
    const phone = norm(document.getElementById('celular').value);
    const message = norm(document.getElementById('consulta').value);

    if(!name || !phone || !message){
      setMsg('Por favor complet√° Nombre y apellido, Celular y Consulta.', 'err');
      return;
    }

    sendBtn.disabled = true;
    sendBtn.textContent = 'Enviando‚Ä¶';

    try{
      const res = await fetch('/api/contact', {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify({ name, phone, message })
      });

      if(!res.ok) throw new Error('Error en el env√≠o');

      setMsg('Mensaje enviado. Gracias, te contactaremos a la brevedad.', 'ok');
      contactForm.reset();
    }catch(err){
      console.error(err);
      setMsg('No se pudo enviar. Intent√° nuevamente en unos minutos.', 'err');
    }finally{
      sendBtn.disabled = false;
      sendBtn.textContent = 'Enviar';
    }
  });

  // Start
  loadExcel();
</script>

</body>
</html>
