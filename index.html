<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Red de Farmacias – Línea Dolor | Alef Medical</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- SheetJS para leer Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #ffffff;
      color: #222;
    }

    /* =====================
       HEADER RED FARMACIAS
    ====================== */
    .header-red-farmacias {
      background: #ffffff;
      padding: 30px 15px 15px;
      border-bottom: 1px solid #e0e0e0;
    }

    .header-logos {
      max-width: 1100px;
      margin: auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
      flex-wrap: wrap;
    }

    .header-logos img {
      max-height: 60px;
      object-fit: contain;
    }

    .header-titulo {
      text-align: center;
      flex: 1;
      min-width: 220px;
    }

    .header-titulo h1 {
      margin: 0;
      font-size: 28px;
      color: #1f2a44;
    }

    /* =====================
       BUSCADOR
    ====================== */
    .buscador {
      max-width: 1100px;
      margin: 25px auto;
      padding: 0 15px;
    }

    .buscador select {
      width: 100%;
      padding: 10px;
      font-size: 16px;
    }

    /* =====================
       LISTADO FARMACIAS
    ====================== */
    .farmacias {
      max-width: 1100px;
      margin: auto;
      padding: 0 15px 30px;
    }

    .farmacia {
      border-bottom: 1px solid #ddd;
      padding: 12px 0;
    }

    .farmacia h4 {
      margin: 0 0 4px;
      font-size: 16px;
    }

    .farmacia p {
      margin: 0;
      font-size: 14px;
      color: #555;
    }

    /* =====================
       BANNER TOTAX
    ====================== */
    .banner-totax {
      max-width: 1100px;
      margin: 30px auto 40px;
      padding: 0 15px;
      text-align: center;
    }

    .banner-totax img {
      max-width: 300px; /* chico */
      height: auto;
      border-radius: 10px;
      cursor: pointer;
    }

    /* =====================
       RESPONSIVE
    ====================== */
    @media (max-width: 768px) {
      .header-logos {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>

  <!-- HEADER + LOGOS -->
  <section class="header-red-farmacias">
    <div class="header-logos">
      <img src="Logo_Oramorph_color.png" alt="Oramorph" />

      <div class="header-titulo">
        <h1>Red de Farmacias</h1>
      </div>

      <img src="Logo_Alefdona_color.png" alt="Alefdona" />
    </div>
  </section>

  <!-- BUSCADOR (sin filtro por defecto) -->
  <div class="buscador">
    <select id="provinciaSelect">
      <option value="" selected>Seleccionar provincia (opcional)</option>
      <option value="Todo">Todo el País</option>
      <!-- provincias dinámicas desde Excel -->
    </select>
  </div>

  <!-- LISTADO -->
  <div class="farmacias" id="listaFarmacias"></div>

  <!-- BANNER TOTAX -->
  <section class="banner-totax">
    <a href="https://totax.com.ar" target="_blank" rel="noopener noreferrer">
      <img src="Banner_Totax.png" alt="TOTAX" />
    </a>
  </section>

  <script>
    let farmacias = [];

    const select = document.getElementById("provinciaSelect");
    const lista = document.getElementById("listaFarmacias");

    function normalizar(texto) {
      return String(texto ?? "").trim();
    }

    function renderFarmacias(provincia) {
      lista.innerHTML = "";

      // Si el usuario NO elige nada => mostrar TODO
      let resultado = farmacias;

      if (provincia && provincia !== "Todo") {
        resultado = farmacias.filter(f => normalizar(f.Provincia) === provincia);
      }

      // Si elige "Todo" => también todo (sin filtro)
      // (lo dejamos explícito para claridad)
      if (provincia === "Todo") resultado = farmacias;

      if (!resultado.length) {
        lista.innerHTML = `<p style="color:#555;font-size:14px;">No se encontraron farmacias para el filtro seleccionado.</p>`;
        return;
      }

      resultado.forEach(f => {
        const nombre = normalizar(f.Farmacia);
        const direccion = normalizar(f.Dirección);

        const div = document.createElement("div");
        div.className = "farmacia";
        div.innerHTML = `
          <h4>${nombre}</h4>
          <p>${direccion}</p>
        `;
        lista.appendChild(div);
      });
    }

    function cargarProvincias() {
      const provincias = [...new Set(farmacias.map(f => normalizar(f.Provincia)).filter(Boolean))];
      provincias.sort((a,b) => a.localeCompare(b, "es"));

      provincias.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p;
        opt.textContent = p;
        select.appendChild(opt);
      });
    }

    // Leer Excel
    fetch("farmacias.xlsx")
      .then(res => {
        if (!res.ok) throw new Error("No se pudo cargar farmacias.xlsx");
        return res.arrayBuffer();
      })
      .then(data => {
        const wb = XLSX.read(data, { type: "array" });
        const sheet = wb.Sheets[wb.SheetNames[0]];
        farmacias = XLSX.utils.sheet_to_json(sheet, { defval: "" });

        cargarProvincias();

        // ✅ Al entrar: mostrar TODO el listado completo, sin filtros
        renderFarmacias("");
      })
      .catch(err => {
        console.error(err);
        lista.innerHTML = `<p style="color:#b00020;font-size:14px;">
          Error cargando el listado. Verificá que <b>farmacias.xlsx</b> esté en la misma carpeta que este HTML.
        </p>`;
      });

    // Filtrar SOLO si el usuario interactúa
    select.addEventListener("change", () => {
      renderFarmacias(select.value);
    });
  </script>

</body>
</html>
